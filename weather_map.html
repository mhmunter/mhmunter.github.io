<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>weather_map</title>
    <script src="js/keys.js"></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v1.2.1/mapbox-gl.css' rel='stylesheet' />
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css" integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous">
    <style>



        #map {

            d-flex: flex-nowrap
        }



        #weatherPanels {
        'border', '3px solid black'
            /*padding-right: ($spacer * .5) !important;*/
            /*padding-right: 5px;*/
        d-flex: flex-nowrap;
            justify-content: space-between;
            width: 15%;
        }




    </style>

</head>
<body class="p-3 mb-2 bg-primary text-gray-dark margin-right : 3px">
<h3></h3>

<div class = 'box'>
    <h1><strong><ins>3 day Weather Forcast:</ins></strong></h1>
    <div ></div>
    <!--    <input id="lat" type="text" name="lat" placeholder="Please enter latitude">-->
    <!--    <input id="log" type="text" name="log" placeholder="Please enter longitude">-->

    <!--    <button id="butn" type="submit">Update the weather!</button>-->
    <div id="weatherPanels" class="d-flex">

    </div>


    <!--    <div  class="row justify-content-center"  class="card-body"  id="weatherPanels" ></div>-->



    <div id='map' style='width: 100%; height: 600px; padding-right: 5px;'></div>
    <pre id='coordinates' class='coordinates'></pre>
</div>





<script src = 'js/mapbox-geocoder-utils.js'></script>
<script src="js/jquery-2.2.4.js"></script>
<script src='https://api.tiles.mapbox.com/mapbox-gl-js/v1.2.1/mapbox-gl.js'></script>
<script>

    // // console.log(data.daily.data[0].apparentTemperatureHigh)
    // console.log(data.daily.data[0].apparentTemperatureHigh)
    // console.log(data.daily.data[0].apparentTemperatureLow)
    // console.log(data.daily.data[0].icon)
    // console.log(data.daily.data[0].humidity)
    // console.log(data.daily.data[0].windSpeed)


    // console.log(data.daily.data[0].summary)
    // function buildWeather(lat, lng) {
    //     // latLong.lat = latitude;
    //     // latLong.lon = longitude;
    //     var weatherRequest = $.get("http://api.openweathermap.org/data/2.5/forecast/daily", {
    //         APPID: "7f8e3aa0aad113510e0c1eaafd1c17b8",
    //         // q: "San Antonio, US",
    //         units: "imperial",
    //         lat: lat,
    //         lon: lng
    //     });
    // weatherRequest.done(function (data) {
    //     var total = "";
    //     total += "<div>" + data.city.name + "</div>";
    //     for (var i = 0; i < 3; i += 1) {
    //         total += "<div class='singleDay'>";
    //         total += outputTemps(data.list[i]);
    //         total += weatherIcon(data.list[i]);
    //         total += showConditions(data.list[i]);
    //         total += showHumidity(data.list[i]);
    //         total += showPressure(data.list[i]);
    //         total += showWind(data.list[i]);
    //         total += "</div>";
    //     }
    //     $('#weatherPanels').html(total);
    //     // console.log(data);
    // });
    // weatherRequest.fail(function (job, status) {
    //     // console.log(status);
    // });


    // ----------------------------------------------------------------------------------------------------------


    //     $.get("https://cors-anywhere.herokuapp.com/https://api.darksky.net/forecast/darkSkyKey/29.4241,-98.4936");
    // console.og(data.daily.data[0].pressure)


    function buildWeather(lat, log){
        // lat = $("#lat").val();
        // log = $("#log").val();
        var weatherRequest =  $.get("https://cors-anywhere.herokuapp.com/https://api.darksky.net/forecast/"+darkSkyKey+ "/" + lat +","+log);
        // console.log(data.daily.data[i]);
        // console.log(data.daily.data[0]);
        //    console.log(data.daily.data[0]);
        // console.log(data.currently.temperature);

        weatherRequest.done(function(data) {
            reverseGeocode({lat:lat, lng:log}, mapBoxToken).then(function(results){
                console.log(results)
                var total = "";
                for (var i=0;i<3;i+=1){
                    total += "<div class='singleDay d-flex border border-secondary'  ;'>";
                    total+= showDate(data.daily.data[i].time);
                    total += outputTemps(data.daily.data[i]);
                    total += showHumidity(data.daily.data[i]);
                    total += showWind(data.daily.data[i]);
                    total += showPresure(data.daily.data[i]);
                    weatherIcons.forEach(function(element) {
                        if (element.condition == data.daily.data[i].icon) {
                            total += "<img src='" + element.source + "'>";
                            //  console.log(element.source)
                        }
                    });

                    total += "</div>";
                    // console.log(data.daily.data[i]);

                }
                // console.log(total);
                $('#weatherPanels').html(total);
            });
        });
        weatherRequest.fail(function (job, status) {
            // console.log(status);
        });
    }
    buildWeather( 29.4241,-98.4936);

    // $("#butn").click(buildWeather);
    // function timeMAth(info){
    //   var NewDate =  data.daily.data[i] * 1000
    // }
    //     //     var dateObject = new Date(1567400400 * 1000);
    //     console.log(dateObject.toString());

    function showDate(info){
        var dateObject = new Date(info * 1000);
        return (dateObject.toDateString());

        // return"<div>Date: "+ info.time  + "</div>";
        // console.log(info)
    }

    function outputTemps(forecastDay) {
        return (Math.round(forecastDay.apparentTemperatureHigh) + "℉" + "/" + Math.round(forecastDay.apparentTemperatureLow) + "℉" );
    }

    function showHumidity(info) {
        return "<div>Humidity: " + info.humidity + "</div>";
    }

    function showWind(info) {
        return "<div>Wind: " + info.windSpeed + "</div>";
    }

    function showPresure(info) {
        return "<div>Presure: " + info.pressure +   "</div>";
    }






    //Weather Icon Array
    var weatherIcons = [
        {
            condition: "cloudy",
            source: "icons/cloud.svg"
        },
        {
            condition: "clear-night",
            source: "icons/moon.svg"
        },
        {
            condition: "clear-day",
            source: "icons/Sun.svg"
        },
        {
            condition: "fog",
            source: "icons/Cloud-Fog.svg"
        },
        {
            condition: "partly-cloudy-day",
            source: "icons/Cloud-Sun.svg"
        },
        {
            condition: "partly-cloudy-night",
            source: "icons/Cloud-Moon.svg"
        },
        {
            condition: "rain",
            source: "icons/Cloud-Rain.svg"
        },
        {
            condition: "sleet",
            source: "icons/Umbrella.svg"
        },
        {
            condition: "snow",
            source: "icons/Snowflake.svg"
        },
        {
            condition: "wind",
            source: "icons/Wind.svg"
        }
    ];



    // ------------------------------------------------------------------------map



    mapboxgl.accessToken = mapBoxToken;
    var coordinates = document.getElementById('coordinates');
    var map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/mapbox/dark-v9',
        zoom: 5,
        center:[-98.4916, 29.4252]
    });

    //
    //
    // geocode(log,lat, mapBoxToken).then(function(result) {
    //     console.log(result);
    // })
    // var lat = $("#lat").val();
    // var log = $("#log").val();
    var marker = new mapboxgl.Marker({
        draggable: true
    })
        .setLngLat([-98.4916, 29.4252])
        .addTo(map);

    function onDragEnd() {
        var lngLat = marker.getLngLat();
        coordinates.style.display = 'block';
        coordinates.innerHTML = 'Longitude: ' + lngLat.lng + '<br />Latitude: ' + lngLat.lat;
        buildWeather(lngLat.lat, lngLat.lng);
        console.log(lngLat.lng,lngLat.lat);
    }

    marker.on('dragend', onDragEnd);








    // time
    //     var dateObject = new Date(1567400400 * 1000);
    //     console.log(dateObject.toString());

    //     $.get("https://cors-anywhere.herokuapp.com/https://api.darksky.net/forecast/"+darkSkyKey+"/29.4241,-98.4936").done(function(data){
    //      console.log(data.daily.data[0].apparentTemperatureHigh)
    //      // console.log(data.daily.data[0])
    //         console.log(data.daily.data[0])
    //        console.log(data.currently.temperature)
    //    });









</script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script>


</body>